<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✅ Sistema de Paginación - Test Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .status-success { color: #28a745; }
        .status-error { color: #dc3545; }
        .status-warning { color: #ffc107; }
        .test-section { border-left: 4px solid #007bff; padding-left: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container-fluid p-4">
        <div class="row">
            <div class="col-12">
                <div class="text-center mb-4">
                    <h1 class="display-4">✅ Sistema de Paginación</h1>
                    <p class="lead">Test Final Completo - 10 Secciones</p>
                </div>

                <!-- Panel de Control -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-gear"></i> Panel de Control</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-success btn-lg w-100 mb-2" onclick="runCompleteTest()">
                                    <i class="bi bi-play-circle"></i> Ejecutar Test Completo
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-info btn-lg w-100 mb-2" onclick="runQuickTest()">
                                    <i class="bi bi-lightning"></i> Test Rápido
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn btn-warning w-100" onclick="testNewSections()">
                                    <i class="bi bi-patch-check"></i> Test Nuevas Secciones
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-secondary w-100" onclick="showSystemInfo()">
                                    <i class="bi bi-info-circle"></i> Info Sistema
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-danger w-100" onclick="clearResults()">
                                    <i class="bi bi-trash"></i> Limpiar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resultados -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-clipboard-data"></i> Resultados del Test</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults">
                            <div class="text-center text-muted">
                                <i class="bi bi-clock fs-3"></i>
                                <p>Ejecuta un test para ver los resultados</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/pagination-system.js"></script>
    <script>
        const testResults = document.getElementById('testResults');

        function clearResults() {
            testResults.innerHTML = `
                <div class="text-center text-muted">
                    <i class="bi bi-clock fs-3"></i>
                    <p>Ejecuta un test para ver los resultados</p>
                </div>
            `;
        }

        function addResult(message, type = 'info', details = '') {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-danger' : 
                             type === 'warning' ? 'alert-warning' : 'alert-info';
            
            const html = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <strong>${message}</strong>
                    ${details ? `<br><small>${details}</small>` : ''}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            testResults.insertAdjacentHTML('beforeend', html);
        }

        function showSystemInfo() {
            clearResults();
            addResult('🔍 Información del Sistema', 'info');

            // Verificar si el sistema está cargado
            if (typeof window.paginationModules === 'object') {
                addResult('✅ Sistema de paginación cargado correctamente', 'success');
                
                const sections = Object.keys(window.paginationModules);
                addResult(`📊 Secciones configuradas: ${sections.length}`, 'info', 
                         `Secciones: ${sections.join(', ')}`);

                // Verificar funciones globales
                const globalFunctions = [
                    'initializePaginationAdmin',
                    'changeItemsPerPageAdmin', 
                    'goToPageAdmin',
                    'loadDataAdmin'
                ];

                let functionsOK = 0;
                globalFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        functionsOK++;
                    }
                });

                addResult(`🔧 Funciones globales: ${functionsOK}/${globalFunctions.length}`, 
                         functionsOK === globalFunctions.length ? 'success' : 'warning');

            } else {
                addResult('❌ Sistema de paginación NO cargado', 'error');
            }
        }

        function testNewSections() {
            clearResults();
            addResult('🆕 Probando las nuevas secciones implementadas', 'info');

            const newSections = ['usuarios', 'citas', 'evaluaciones', 'faqs', 'reportes', 'pagos'];
            let successCount = 0;

            newSections.forEach(section => {
                try {
                    if (window.paginationModules && window.paginationModules[section]) {
                        const module = window.paginationModules[section];
                        
                        // Verificar configuración
                        const hasConfig = module.itemsPerPage && module.testData;
                        const hasRenderFunction = typeof module.renderPage === 'function';
                        const dataCount = module.testData ? module.testData.length : 0;

                        if (hasConfig && hasRenderFunction && dataCount > 0) {
                            addResult(`✅ ${section.toUpperCase()}`, 'success', 
                                     `${dataCount} items de prueba, función render disponible`);
                            successCount++;
                        } else {
                            addResult(`⚠️ ${section.toUpperCase()}`, 'warning', 
                                     `Config: ${hasConfig}, Render: ${hasRenderFunction}, Datos: ${dataCount}`);
                        }
                    } else {
                        addResult(`❌ ${section.toUpperCase()}`, 'error', 'Sección no configurada');
                    }
                } catch (error) {
                    addResult(`💥 ${section.toUpperCase()}`, 'error', `Error: ${error.message}`);
                }
            });

            const percentage = Math.round((successCount / newSections.length) * 100);
            addResult(`📈 Resultado Final: ${successCount}/${newSections.length} secciones (${percentage}%)`, 
                     percentage === 100 ? 'success' : percentage >= 80 ? 'warning' : 'error');
        }

        function runQuickTest() {
            clearResults();
            addResult('⚡ Ejecutando Test Rápido', 'info');

            // Test básico
            showSystemInfo();
            
            setTimeout(() => {
                testNewSections();
            }, 1000);
        }

        function runCompleteTest() {
            clearResults();
            addResult('🚀 Iniciando Test Completo del Sistema', 'info');

            // Test 1: Verificar carga del sistema
            setTimeout(() => {
                showSystemInfo();
            }, 500);

            // Test 2: Verificar todas las secciones
            setTimeout(() => {
                addResult('📋 Verificando todas las secciones...', 'info');
                
                const allSections = ['inventario', 'sedes', 'categorias', 'proveedores', 
                                   'usuarios', 'citas', 'evaluaciones', 'faqs', 'reportes', 'pagos'];
                let totalSuccess = 0;

                allSections.forEach((section, index) => {
                    setTimeout(() => {
                        try {
                            if (window.paginationModules && window.paginationModules[section]) {
                                const module = window.paginationModules[section];
                                
                                // Simular renderizado
                                if (typeof module.renderPage === 'function' && module.testData) {
                                    // Crear elementos temporales para test
                                    const tempDiv = document.createElement('div');
                                    tempDiv.innerHTML = `
                                        <table id="${section}Table"><tbody></tbody></table>
                                        <div id="${section}PaginationInfo" style="display:none;">
                                            <span id="${section}Showing">0</span>
                                            <span id="${section}Total">0</span>
                                        </div>
                                        <div id="${section}Pagination" style="display:none;"></div>
                                    `;
                                    document.body.appendChild(tempDiv);

                                    try {
                                        module.renderPage(module.testData.slice(0, 10), 1, 10);
                                        addResult(`✅ ${section}`, 'success', 
                                                 `Renderizado exitoso con ${module.testData.length} items`);
                                        totalSuccess++;
                                    } catch (renderError) {
                                        addResult(`⚠️ ${section}`, 'warning', 
                                                 `Error en renderizado: ${renderError.message}`);
                                    }

                                    document.body.removeChild(tempDiv);
                                } else {
                                    addResult(`❌ ${section}`, 'error', 'Sin función render o datos de prueba');
                                }
                            } else {
                                addResult(`❌ ${section}`, 'error', 'Sección no configurada');
                            }
                        } catch (error) {
                            addResult(`💥 ${section}`, 'error', `Error: ${error.message}`);
                        }

                        // Resultado final
                        if (index === allSections.length - 1) {
                            setTimeout(() => {
                                const percentage = Math.round((totalSuccess / allSections.length) * 100);
                                let resultType = 'success';
                                let resultIcon = '🎉';
                                
                                if (percentage < 80) {
                                    resultType = 'warning';
                                    resultIcon = '⚠️';
                                }
                                if (percentage < 60) {
                                    resultType = 'error';
                                    resultIcon = '❌';
                                }

                                addResult(`${resultIcon} TEST COMPLETO FINALIZADO`, resultType,
                                         `Resultado: ${totalSuccess}/${allSections.length} secciones funcionando correctamente (${percentage}%)`);
                            }, 500);
                        }
                    }, index * 200);
                });
            }, 2000);
        }

        // Auto-ejecutar test rápido al cargar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                addResult('🔄 Cargando sistema...', 'info');
                setTimeout(runQuickTest, 1000);
            }, 500);
        });
    </script>
</body>
</html>