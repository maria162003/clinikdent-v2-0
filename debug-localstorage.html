<!DOCTYPE html>
<html>
<head>
    <title>Debug LocalStorage Actual</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .key { font-weight: bold; color: #0066cc; }
        .value { background: #f5f5f5; padding: 5px; margin: 5px 0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>üîç Debug LocalStorage Actual</h1>
    
    <div class="section">
        <h3>üìã Contenido Completo de LocalStorage:</h3>
        <div id="fullStorage"></div>
    </div>
    
    <div class="section">
        <h3>üéØ Valores Espec√≠ficos de Autenticaci√≥n:</h3>
        <div id="authValues"></div>
    </div>
    
    <div class="section">
        <h3>üõ†Ô∏è Acciones:</h3>
        <button onclick="debugGetUserId()" style="padding: 10px; margin: 5px;">Simular getUserId()</button>
        <button onclick="clearSpecificAuth()" style="padding: 10px; margin: 5px; background: #ff6666; color: white;">Limpiar Auth Espec√≠fico</button>
        <button onclick="setCorrectJuanData()" style="padding: 10px; margin: 5px; background: #66cc66; color: white;">Establecer Datos Correctos de Juan</button>
    </div>
    
    <div class="section">
        <h3>üìä Resultado de Debug:</h3>
        <div id="debugResult"></div>
    </div>

    <script>
        function displayFullStorage() {
            const fullDiv = document.getElementById('fullStorage');
            let html = '';
            
            if (localStorage.length === 0) {
                html = '<div class="error">LocalStorage est√° vac√≠o</div>';
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    html += `<div><span class="key">${key}:</span><div class="value">${value}</div></div>`;
                }
            }
            
            fullDiv.innerHTML = html;
        }
        
        function displayAuthValues() {
            const authDiv = document.getElementById('authValues');
            
            const userId = localStorage.getItem('userId');
            const userRole = localStorage.getItem('userRole'); 
            const userStr = localStorage.getItem('user');
            
            let userObj = null;
            try {
                userObj = userStr ? JSON.parse(userStr) : null;
            } catch (e) {
                userObj = `Error parseando: ${e.message}`;
            }
            
            authDiv.innerHTML = `
                <div><span class="key">userId:</span> <span class="value">${userId || 'null'}</span></div>
                <div><span class="key">userRole:</span> <span class="value">${userRole || 'null'}</span></div>
                <div><span class="key">user object:</span> <div class="value">${JSON.stringify(userObj, null, 2)}</div></div>
            `;
        }
        
        function debugGetUserId() {
            // Simular exactamente lo que hace el m√©todo getUserId()
            const userId = localStorage.getItem('userId');
            let userObjId = null;
            
            const userStr = localStorage.getItem('user');
            if (userStr) {
                try {
                    const userObj = JSON.parse(userStr);
                    userObjId = userObj?.id;
                } catch (e) {
                    userObjId = `Error: ${e.message}`;
                }
            }
            
            const finalResult = userId || userObjId;
            
            document.getElementById('debugResult').innerHTML = `
                <h4>üîç Simulaci√≥n de getUserId():</h4>
                <div><span class="key">localStorage.getItem('userId'):</span> <span class="value">${userId || 'null'}</span></div>
                <div><span class="key">localStorage.getItem('user')?.id:</span> <span class="value">${userObjId || 'null'}</span></div>
                <div><span class="key">Resultado final (userId || user?.id):</span> <span class="value ${finalResult == 3 ? 'error' : 'success'}">${finalResult}</span></div>
                ${finalResult == 3 ? '<div class="error">‚ö†Ô∏è PROBLEMA: Est√° devolviendo ID 3 (Mar√≠a Gonz√°lez)</div>' : ''}
                ${finalResult == 4 ? '<div class="success">‚úÖ CORRECTO: Est√° devolviendo ID 4 (Juan P√©rez)</div>' : ''}
            `;
        }
        
        function clearSpecificAuth() {
            localStorage.removeItem('userId');
            localStorage.removeItem('userRole');
            localStorage.removeItem('user');
            alert('‚úÖ Datos de autenticaci√≥n eliminados');
            displayFullStorage();
            displayAuthValues();
        }
        
        function setCorrectJuanData() {
            localStorage.setItem('userId', '4');
            localStorage.setItem('userRole', 'paciente');
            localStorage.setItem('user', JSON.stringify({
                id: 4,
                nombre: 'Juan',
                apellido: 'P√©rez',
                rol: 'paciente'
            }));
            alert('‚úÖ Datos correctos de Juan P√©rez establecidos');
            displayFullStorage();
            displayAuthValues();
        }
        
        // Mostrar datos al cargar
        displayFullStorage();
        displayAuthValues();
        
        // Auto-refresh cada 2 segundos
        setInterval(() => {
            displayFullStorage();
            displayAuthValues();
        }, 2000);
    </script>
</body>
</html>