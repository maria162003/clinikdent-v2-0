<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Clinik Dent - Excelencia en Odontología</title>
  <script>if(window.location.hash.includes('access_token')&&window.location.hash.includes('type=recovery')){window.location.replace('/nueva-password-supabase.html'+window.location.hash);}</script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/carrusel.css">
  <link rel="stylesheet" href="css/chat-soporte.css">
  <style>
    .recovery-step {
      min-height: 300px;
      transition: all 0.3s ease;
    }
    .recovery-step.active {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <!-- Barra de navegación mejorada -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="images/logo.jpg" alt="Clinik Dent Logo" class="img-fluid" style="max-height: 60px;">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#inicio">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#servicios">Servicios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#equipo">Equipo</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#testimonios">Testimonios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#noticias">Noticias</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#faqs">FAQs</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#pqrs">PQRS</a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link btn btn-outline-primary me-2" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">
              <i class="fas fa-user me-1"></i> Iniciar Sesión
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link btn btn-primary" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">
              <i class="fas fa-user-plus me-1"></i> Registrarse
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section con Carrusel -->
  <section id="inicio" class="hero-section">
    <div id="mainCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="2"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="images/hero1.jpg" class="d-block w-100" alt="Clínica moderna">
          <div class="carousel-caption d-none d-md-block">
            <h1>Sonrisas saludables, vidas felices</h1>
            <p>Tecnología de vanguardia para tu salud dental</p>
            <a href="#servicios" class="btn btn-primary btn-lg">Nuestros Servicios</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/hero2.jpg" class="d-block w-100" alt="Atención personalizada">
          <div class="carousel-caption d-none d-md-block">
            <h1>Atención personalizada</h1>
            <p>Profesionales altamente calificados</p>
            <a href="#equipo" class="btn btn-primary btn-lg">Conoce nuestro equipo</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/hero3.jpg" class="d-block w-100" alt="Promociones especiales">
          <div class="carousel-caption d-none d-md-block">
            <h1>Promociones especiales</h1>
            <p>Blanqueamiento dental 20% de descuento</p>
            <a href="#noticias" class="btn btn-primary btn-lg">Ver promociones</a>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </section>

  <!-- Sección de Servicios -->
  <section id="servicios" class="py-5 bg-light">
    <div class="container">
      <div class="section-header text-center mb-5">
        <h2 class="display-4">Nuestros Servicios</h2>
        <p class="lead">Tratamientos dentales especializados con la más alta tecnología</p>
      </div>
      
      <div class="row g-4" data-static="true">
        <div class="col-md-4">
          <div class="card service-card h-100 border-0 shadow-sm">
            <img src="images/service1.jpg" class="card-img-top" alt="Odontología General">
            <div class="card-body">
              <h3 class="h4">Odontología General</h3>
              <p class="card-text">Revisiones, limpiezas, empastes y tratamientos preventivos para mantener tu salud bucal.</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="#pqrs" class="btn btn-outline-primary">Más información</a>
            </div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card service-card h-100 border-0 shadow-sm">
            <div class="badge bg-success position-absolute top-0 end-0 m-2">Promoción</div>
            <img src="images/service2.jpg" class="card-img-top" alt="Ortodoncia">
            <div class="card-body">
              <h3 class="h4">Ortodoncia</h3>
              <p class="card-text">Brackets metálicos, estéticos e invisalign para corregir la posición de tus dientes.</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="#pqrs" class="btn btn-outline-primary">Más información</a>
            </div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card service-card h-100 border-0 shadow-sm">
            <img src="images/service3.jpg" class="card-img-top" alt="Estética Dental">
            <div class="card-body">
              <h3 class="h4">Estética Dental</h3>
              <p class="card-text">Blanqueamientos, carillas y coronas para una sonrisa perfecta y natural.</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="#pqrs" class="btn btn-outline-primary">Más información</a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Estadísticas de la clínica -->
      <div class="row mt-5 text-center">
        <div class="col-md-4">
          <div class="bg-white p-4 rounded shadow-sm">
            <h3 class="text-primary mb-1">500+</h3>
            <p class="text-muted mb-0">Pacientes Satisfechos</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="bg-white p-4 rounded shadow-sm">
            <h3 class="text-primary mb-1">4.9</h3>
            <p class="text-muted mb-0">Calificación Promedio</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="bg-white p-4 rounded shadow-sm">
            <h3 class="text-primary mb-1">95%</h3>
            <p class="text-muted mb-0">Recomiendan Nuestros Servicios</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Equipo Profesional -->
  <section id="equipo" class="py-5">
    <div class="container">
      <div class="section-header text-center mb-5">
        <h2 class="display-4">Nuestro Equipo</h2>
        <p class="lead">Profesionales altamente calificados</p>
      </div>
      
      <div class="row g-4" id="teamCards" data-static="true">
        <div class="col-md-3 col-sm-6">
          <div class="card team-card h-100 border-0 shadow-sm">
            <img src="images/doctor1.jpg" class="card-img-top rounded-circle mx-auto mt-3" style="width: 150px; height: 150px; object-fit: cover;" alt="Dra. Ana Pérez">
            <div class="card-body text-center">
              <h3 class="h5">Dra. Ana Pérez</h3>
              <p class="text-muted">Ortodoncia</p>
              <p class="card-text">Especialista en ortodoncia invisible con más de 10 años de experiencia.</p>
              <a href="#" class="btn btn-sm btn-outline-primary"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 col-sm-6">
          <div class="card team-card h-100 border-0 shadow-sm">
            <img src="images/doctor2.jpg" class="card-img-top rounded-circle mx-auto mt-3" style="width: 150px; height: 150px; object-fit: cover;" alt="Dr. Juan Gómez">
            <div class="card-body text-center">
              <h3 class="h5">Dr. Juan Gómez</h3>
              <p class="text-muted">Estética Dental</p>
              <p class="card-text">Especialista en rehabilitación oral y estética dental.</p>
              <a href="#" class="btn btn-sm btn-outline-primary"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 col-sm-6">
          <div class="card team-card h-100 border-0 shadow-sm">
            <img src="images/doctor3.jpg" class="card-img-top rounded-circle mx-auto mt-3" style="width: 150px; height: 150px; object-fit: cover;" alt="Dra. Laura Ruiz">
            <div class="card-body text-center">
              <h3 class="h5">Dra. Laura Ruiz</h3>
              <p class="text-muted">Odontología General</p>
              <p class="card-text">Especialista en odontología preventiva para toda la familia.</p>
              <a href="#" class="btn btn-sm btn-outline-primary"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
        </div>
        
        <div class="col-md-3 col-sm-6">
          <div class="card team-card h-100 border-0 shadow-sm">
            <img src="images/doctor4.jpg" class="card-img-top rounded-circle mx-auto mt-3" style="width: 150px; height: 150px; object-fit: cover;" alt="Dr. Carlos Méndez">
            <div class="card-body text-center">
              <h3 class="h5">Dr. Carlos Méndez</h3>
              <p class="text-muted">Cirugía Oral</p>
              <p class="card-text">Especialista en implantes dentales y cirugías complejas.</p>
              <a href="#" class="btn btn-sm btn-outline-primary"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Noticias -->
  <section id="noticias" class="py-5 bg-light">
    <div class="container">
      <div class="section-header text-center mb-5">
        <h2 class="display-4">Noticias y Promociones</h2>
        <p class="lead">Mantente informado sobre nuestras últimas novedades</p>
      </div>
      
      <div class="row g-4" id="newsCards" data-static="true">
        <div class="col-md-4">
          <div class="card news-card h-100 border-0 shadow-sm">
            <div class="badge bg-primary position-absolute top-0 start-0 m-2">15 JUN</div>
            <img src="images/news1.jpg" class="card-img-top" alt="Promoción Blanqueamiento">
            <div class="card-body">
              <h3 class="h5">Promoción Blanqueamiento</h3>
              <p class="card-text">¡Aprovecha nuestro 20% de descuento en blanqueamiento dental este mes!</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="noticias.html" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-arrow-right me-1"></i> Leer más
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card news-card h-100 border-0 shadow-sm">
            <div class="badge bg-primary position-absolute top-0 start-0 m-2">1 JUL</div>
            <img src="images/news2.jpg" class="card-img-top" alt="Nuevo Equipo Digital">
            <div class="card-body">
              <h3 class="h5">Nuevo Equipo Digital</h3>
              <p class="card-text">Contamos con la última tecnología en radiología digital para tu diagnóstico.</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="noticias.html" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-arrow-right me-1"></i> Leer más
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card news-card h-100 border-0 shadow-sm">
            <div class="badge bg-primary position-absolute top-0 start-0 m-2">20 MAY</div>
            <img src="images/news3.jpg" class="card-img-top" alt="Jornada de Salud Oral">
            <div class="card-body">
              <h3 class="h5">Jornada de Salud Oral</h3>
              <p class="card-text">Valoración gratuita para niños y adultos. ¡Agenda tu cita!</p>
            </div>
            <div class="card-footer bg-transparent border-0">
              <a href="noticias.html" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-arrow-right me-1"></i> Leer más
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="text-center mt-4">
        <a href="noticias.html" class="btn btn-primary">
          <i class="fas fa-newspaper me-2"></i> Ver todas las noticias
        </a>
      </div>
    </div>
  </section>

  <!-- Sección de Testimonios -->
  <section id="testimonios" class="py-5" style="background: linear-gradient(135deg, #f7f9fb 80%, #e3f2fd 100%); display: block !important; visibility: visible !important; opacity: 1 !important;">
    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="text-center mb-5">
            <h2 class="display-4" style="color:#0077b6;">Nuestros Pacientes <small class="text-muted d-block mt-2" style="font-size:1.2rem;">Lo que dicen sobre nosotros</small></h2>
          </div>
        </div>
        <div class="col-lg-8 col-md-10 col-12">
          <div class="d-flex justify-content-center">
            <div id="testimonialsCarousel" class="carousel slide w-100" data-bs-ride="carousel" data-bs-interval="6000" style="max-width: 700px; box-shadow:0 8px 32px rgba(0,163,225,0.08);border-radius:18px;background:white; display: block !important; visibility: visible !important; opacity: 1 !important;">
              <div class="carousel-indicators">
                <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="0" class="active" style="background-color:#0077b6;"></button>
                <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="1" style="background-color:#0077b6;"></button>
                <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="2" style="background-color:#0077b6;"></button>
                <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="3" style="background-color:#0077b6;"></button>
              </div>
            
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div class="testimonial-box text-center" style="padding:50px 30px;">
                  <div class="tst-image mb-4">
                    <img src="images/paciente1.jpg" class="img-fluid rounded-circle" alt="María González" loading="lazy" style="width:110px; height:110px; object-fit:cover; margin:0 auto; border:4px solid #00a3e1;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjU1IiBjeT0iNTUiIHI9IjU1IiBmaWxsPSIjMDBhM2UxIi8+Cjx0ZXh0IHg9IjU1IiB5PSI2NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjMwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TUc8L3RleHQ+Cjwvc3ZnPg=='">
                  </div>
                  <div class="tst-author mb-3">
                    <h4 style="color:#0077b6; font-weight:600;">María González</h4>
                    <span style="color:#888; font-size:1.1rem;">Implantes Dentales</span>
                  </div>
                  <div class="mb-4">
                    <i class="fas fa-quote-left" style="color:#00a3e1; font-size:2rem; opacity:0.3;"></i>
                  </div>
                  <p style="font-size:18px; color:#333; font-style:italic; margin:20px 0 25px; line-height:1.6;">"Excelente atención desde el primer día. El Dr. García y su equipo fueron muy profesionales y me explicaron todo el proceso paso a paso. Mis implantes quedaron perfectos y ahora puedo sonreír con confianza."</p>
                  <div class="tst-rating mb-3" style="color:#ffb300; font-size:20px;">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                  </div>
                </div>
              </div>
              
              <div class="carousel-item">
                <div class="testimonial-box text-center" style="padding:50px 30px;">
                  <div class="tst-image mb-4">
                    <img src="images/paciente2.jpg" class="img-fluid rounded-circle" alt="Carlos Rodríguez" loading="lazy" style="width:110px; height:110px; object-fit:cover; margin:0 auto; border:4px solid #00a3e1;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjU1IiBjeT0iNTUiIHI9IjU1IiBmaWxsPSIjMDBhM2UxIi8+Cjx0ZXh0IHg9IjU1IiB5PSI2NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjMwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Q1I8L3RleHQ+Cjwvc3ZnPg=='">
                  </div>
                  <div class="tst-author mb-3">
                    <h4 style="color:#0077b6; font-weight:600;">Carlos Rodríguez</h4>
                    <span style="color:#888; font-size:1.1rem;">Ortodoncia Invisible</span>
                  </div>
                  <div class="mb-4">
                    <i class="fas fa-quote-left" style="color:#00a3e1; font-size:2rem; opacity:0.3;"></i>
                  </div>
                  <p style="font-size:18px; color:#333; font-style:italic; margin:20px 0 25px; line-height:1.6;">"Decidí usar ortodoncia invisible y fue la mejor decisión. El tratamiento fue cómodo, discreto y los resultados superaron mis expectativas. Todo el personal es muy amable y profesional."</p>
                  <div class="tst-rating mb-3" style="color:#ffb300; font-size:20px;">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                  </div>
                </div>
              </div>
              
              <div class="carousel-item">
                <div class="testimonial-box text-center" style="padding:50px 30px;">
                  <div class="tst-image mb-4">
                    <img src="images/paciente3.jpg" class="img-fluid rounded-circle" alt="Ana Fernández" loading="lazy" style="width:110px; height:110px; object-fit:cover; margin:0 auto; border:4px solid #00a3e1;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjU1IiBjeT0iNTUiIHI9IjU1IiBmaWxsPSIjMDBhM2UxIi8+Cjx0ZXh0IHg9IjU1IiB5PSI2NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjMwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QUY8L3RleHQ+Cjwvc3ZnPg=='">
                  </div>
                  <div class="tst-author mb-3">
                    <h4 style="color:#0077b6; font-weight:600;">Ana Fernández</h4>
                    <span style="color:#888; font-size:1.1rem;">Blanqueamiento Dental</span>
                  </div>
                  <div class="mb-4">
                    <i class="fas fa-quote-left" style="color:#00a3e1; font-size:2rem; opacity:0.3;"></i>
                  </div>
                  <p style="font-size:18px; color:#333; font-style:italic; margin:20px 0 25px; line-height:1.6;">"El blanqueamiento dental que me realizaron fue increíble. En solo una sesión mis dientes se veían más blancos y brillantes. La clínica tiene un ambiente muy acogedor y limpio."</p>
                  <div class="tst-rating mb-3" style="color:#ffb300; font-size:20px;">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                  </div>
                </div>
              </div>
              
              <div class="carousel-item">
                <div class="testimonial-box text-center" style="padding:50px 30px;">
                  <div class="tst-image mb-4">
                    <img src="images/doctor1.jpg" class="img-fluid rounded-circle" alt="José Martínez" loading="lazy" style="width:110px; height:110px; object-fit:cover; margin:0 auto; border:4px solid #00a3e1;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjU1IiBjeT0iNTUiIHI9IjU1IiBmaWxsPSIjMDBhM2UxIi8+Cjx0ZXh0IHg9IjU1IiB5PSI2NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjMwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Sk08L3RleHQ+Cjwvc3ZnPg=='">
                  </div>
                  <div class="tst-author mb-3">
                    <h4 style="color:#0077b6; font-weight:600;">José Martínez</h4>
                    <span style="color:#888; font-size:1.1rem;">Limpieza Dental</span>
                  </div>
                  <div class="mb-4">
                    <i class="fas fa-quote-left" style="color:#00a3e1; font-size:2rem; opacity:0.3;"></i>
                  </div>
                  <p style="font-size:18px; color:#333; font-style:italic; margin:20px 0 25px; line-height:1.6;">"Vengo regularmente para mis limpiezas dentales y siempre recibo un trato excelente. El equipo es muy cuidadoso y me hace sentir cómodo. Definitivamente recomiendo Clinik Dent a mis amigos y familia."</p>
                  <div class="tst-rating mb-3" style="color:#ffb300; font-size:20px;">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <button class="carousel-control-prev" type="button" data-bs-target="#testimonialsCarousel" data-bs-slide="prev" style="width:50px; height:50px; background:rgba(0,119,182,0.8); border-radius:50%; top:50%; transform:translateY(-50%); left:-25px;">
              <span class="carousel-control-prev-icon" aria-hidden="true" style="background-image:none;">
                <i class="fas fa-chevron-left" style="color:white; font-size:20px;"></i>
              </span>
              <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#testimonialsCarousel" data-bs-slide="next" style="width:50px; height:50px; background:rgba(0,119,182,0.8); border-radius:50%; top:50%; transform:translateY(-50%); right:-25px;">
              <span class="carousel-control-next-icon" aria-hidden="true" style="background-image:none;">
                <i class="fas fa-chevron-right" style="color:white; font-size:20px;"></i>
              </span>
              <span class="visually-hidden">Siguiente</span>
            </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de FAQs -->
  <section id="faqs" class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="section-header text-center mb-5">
            <h2 class="display-4">Preguntas Frecuentes</h2>
            <p class="lead text-muted">Resolvemos las dudas más comunes sobre nuestros servicios dentales</p>
          </div>
        </div>
      </div>
      
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="accordion" id="faqAccordion">
            <div class="alert alert-secondary mb-0">Cargando preguntas frecuentes...</div>
          </div>
        </div>
      </div>

      <!-- Sección adicional con botón de chat -->
      <div class="row mt-5">
        <div class="col-12 text-center">
          <div class="bg-light p-4 rounded-3">
            <h4 class="mb-3">¿No encontraste tu respuesta?</h4>
            <p class="text-muted mb-3">Nuestro asistente virtual está disponible 24/7 para resolver todas tus dudas</p>
            <button class="btn btn-primary btn-lg" onclick="abrirChatSoporte()">
              <i class="fas fa-comments me-2"></i>
              Chatear Ahora
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección PQRS -->
  <section id="pqrs" class="py-5 bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-6">
          <div class="section-header mb-5">
            <h2 class="display-4">PQRS</h2>
            <p class="lead">Peticiones, Quejas, Reclamos y Sugerencias</p>
          </div>
          
          <form id="pqrsForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="nombre_completo" class="form-label">Nombre completo</label>
                <input type="text" class="form-control" id="nombre_completo" name="nombre_completo" required>
              </div>
              
              <div class="col-md-6">
                <label for="correo" class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="correo" name="correo" required>
              </div>
              
              <div class="col-md-6">
                <label for="telefono" class="form-label">Teléfono</label>
                <input type="tel" class="form-control" id="telefono" name="telefono">
              </div>
              
              <div class="col-md-6">
                <label for="numero_documento" class="form-label">Número de documento</label>
                <input type="text" class="form-control" id="numero_documento" name="numero_documento">
              </div>
              
              <div class="col-12">
                <label for="tipo" class="form-label">Tipo de PQRS</label>
                <select class="form-select" id="tipo" name="tipo" required>
                  <option value="">Seleccione una opción</option>
                  <option value="Petición">Petición - Solicitud de información o servicios</option>
                  <option value="Queja">Queja - Manifestación de insatisfacción</option>
                  <option value="Reclamo">Reclamo - Expresión de inconformidad por servicio recibido</option>
                  <option value="Sugerencia">Sugerencia - Propuesta para mejorar nuestros servicios</option>
                </select>
              </div>
              
              <div class="col-12">
                <label for="descripcion" class="form-label">Descripción detallada</label>
                <textarea class="form-control" id="descripcion" name="descripcion" rows="6" placeholder="Describe detalladamente tu petición, queja, reclamo o sugerencia..." required></textarea>
              </div>
              
              <div class="col-12">
                <label for="servicio_relacionado" class="form-label">Servicio relacionado (opcional)</label>
                <select class="form-select" id="servicio_relacionado" name="servicio_relacionado">
                  <option value="">Seleccionar servicio</option>
                  <option value="odontologia-general">Odontología General</option>
                  <option value="ortodoncia">Ortodoncia</option>
                  <option value="estetica">Estética Dental</option>
                  <option value="implantes">Implantes Dentales</option>
                  <option value="cirugia">Cirugía Oral</option>
                  <option value="atencion-cliente">Atención al Cliente</option>
                  <option value="facturacion">Facturación</option>
                  <option value="citas">Sistema de Citas</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
              
              <div class="col-12">
                <div id="pqrs-success" class="alert alert-success d-none">
                  <i class="fas fa-check-circle me-2"></i>¡Tu PQRS ha sido enviada correctamente! 
                  <br><small>Recibirás una respuesta en un máximo de 15 días hábiles.</small>
                </div>
                <div id="pqrs-error" class="alert alert-danger d-none"></div>
                <button class="btn btn-primary" type="submit">
                  <i class="fas fa-paper-plane me-2"></i>Enviar PQRS
                </button>
              </div>
            </div>
          </form>
        </div>
        
        <div class="col-lg-6">
          <div class="contact-info bg-white p-4 h-100 rounded shadow-sm">
            <h3 class="h4 mb-4">Información de contacto</h3>
            
            <div class="d-flex mb-3">
              <div class="me-3 text-primary">
                <i class="fas fa-map-marker-alt fa-lg"></i>
              </div>
              <div>
                <h4 class="h6 mb-0">Dirección</h4>
                <p class="mb-0">Calle 123 #45-67, Bogotá, Colombia</p>
              </div>
            </div>
            
            <div class="d-flex mb-3">
              <div class="me-3 text-primary">
                <i class="fas fa-phone fa-lg"></i>
              </div>
              <div>
                <h4 class="h6 mb-0">Teléfono</h4>
                <p class="mb-0"><a href="tel:+5712345678">+57 123 456 78</a></p>
              </div>
            </div>
            
            <div class="d-flex mb-3">
              <div class="me-3 text-primary">
                <i class="fab fa-whatsapp fa-lg"></i>
              </div>
              <div>
                <h4 class="h6 mb-0">WhatsApp</h4>
                <p class="mb-0"><a href="https://wa.me/573209773983">+57 320 977 3983</a></p>
              </div>
            </div>
            
            <div class="d-flex mb-4">
              <div class="me-3 text-primary">
                <i class="fas fa-envelope fa-lg"></i>
              </div>
              <div>
                <h4 class="h6 mb-0">Email</h4>
                <p class="mb-0"><a href="mailto:info@clinikdent.com">info@clinikdent.com</a></p>
              </div>
            </div>
            
            <h3 class="h4 mb-3">Horario de atención</h3>
            <ul class="list-unstyled" id="horarioAtencion">
              <li class="mb-2"><strong>Lunes a Viernes:</strong> <span id="horarioSemana">8:00 am - 8:00 pm</span></li>
              <li class="mb-2"><strong>Sábados:</strong> <span id="horarioSabado">8:00 am - 4:00 pm</span></li>
              <li><strong>Urgencias:</strong> 24 horas / 7 días</li>
            </ul>
            
            <div class="map-container mt-4 rounded overflow-hidden shadow-sm">
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3976.785244606093!2d-74.08390972468331!3d4.638129942336037!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e3f9a3b0b0b0b0b%3A0xb0b0b0b0b0b0b0b0!2sBogot%C3%A1%2C%20Colombia!5e0!3m2!1sen!2sus!4v1620000000000!5m2!1sen!2sus" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>



  <!-- Footer -->
  <footer class="bg-dark text-white py-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-4">
          <img src="images/logo.jpg" alt="Clinik Dent Logo" class="mb-3" style="max-height: 60px;">
          <p>Tu clínica odontológica de confianza en Bogotá. Ofrecemos tratamientos integrales con tecnología de punta y profesionales altamente calificados.</p>
          
          <div class="social-icons mt-4">
            <a href="#" class="text-white me-3"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-white me-3"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-white me-3"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
        
        <div class="col-lg-2 col-md-6">
          <h3 class="h5 mb-4">Enlaces rápidos</h3>
          <ul class="list-unstyled">
            <li class="mb-2"><a href="#servicios" class="text-white text-decoration-none">Servicios</a></li>
            <li class="mb-2"><a href="#equipo" class="text-white text-decoration-none">Nuestro Equipo</a></li>
            <li class="mb-2"><a href="#testimonios" class="text-white text-decoration-none">Testimonios</a></li>
            <li class="mb-2"><a href="#noticias" class="text-white text-decoration-none">Noticias</a></li>
            <li class="mb-2"><a href="#pqrs" class="text-white text-decoration-none">PQRS</a></li>
            <li><a href="#pqrs" class="text-white text-decoration-none">PQRS</a></li>
          </ul>
        </div>
        
        <div class="col-lg-3 col-md-6">
          <h3 class="h5 mb-4">Horario de atención</h3>
          <ul class="list-unstyled" id="horarioFooter">
            <li class="mb-2"><strong>Lunes a Viernes:</strong> <span id="horarioSemanaFooter">8:00 am - 8:00 pm</span></li>
            <li class="mb-2"><strong>Sábados:</strong> <span id="horarioSabadoFooter">8:00 am - 4:00 pm</span></li>
            <li><strong>Urgencias:</strong> 24 horas / 7 días</li>
          </ul>
          
          <h3 class="h5 mt-4 mb-3">Contacto</h3>
          <ul class="list-unstyled">
            <li class="mb-2"><i class="fas fa-phone me-2"></i> +57 123 456 78</li>
            <li><i class="fas fa-envelope me-2"></i> info@clinikdent.com</li>
          </ul>
        </div>
        
        <div class="col-lg-3">
          <h3 class="h5 mb-4">Boletín informativo</h3>
          <p>Suscríbete para recibir promociones especiales y consejos de salud dental.</p>
          
          <form class="mt-3">
            <div class="input-group mb-3">
              <input type="email" class="form-control" placeholder="Tu correo electrónico" aria-label="Tu correo electrónico">
              <button class="btn btn-primary" type="button">Suscribirse</button>
            </div>
          </form>
        </div>
      </div>
      
      <hr class="my-4">
      
      <div class="row">
        <div class="col-md-6 text-center text-md-start">
          <p class="mb-0">&copy; <span id="current-year"></span> Clinik Dent. Todos los derechos reservados.</p>
        </div>
        <div class="col-md-6 text-center text-md-end">
          <p class="mb-0">
            <a href="#" class="text-white text-decoration-none me-3">Política de privacidad</a>
            <a href="#" class="text-white text-decoration-none">Términos y condiciones</a>
          </p>
        </div>
      </div>
    </div>
  </footer>



  <!-- Modal Login Unificado -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">Acceso a tu cuenta</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <p class="text-muted">Ingresa tus credenciales</p>
          </div>
          
          <form id="form-login-universal">
            <div class="mb-3">
              <label for="login-email" class="form-label">Correo electrónico</label>
              <input type="email" class="form-control" id="login-email" placeholder="Ingresa tu correo" required>
            </div>
            <div class="mb-3">
              <label for="login-password" class="form-label">Contraseña</label>
              <input type="password" class="form-control" id="login-password" placeholder="Ingresa tu contraseña" required>
            </div>
            
            <!-- Indicador de carga -->
            <div id="login-loading" class="text-center mb-3" style="display: none;">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Verificando credenciales...</span>
              </div>
              <small class="text-muted d-block mt-2">Verificando credenciales...</small>
            </div>
            
            <button type="submit" class="btn btn-primary w-100" id="login-submit-btn">
              <i class="fas fa-sign-in-alt me-2"></i>Iniciar sesión
            </button>
            
            <div class="text-center mt-3">
              <a href="#" data-bs-toggle="modal" data-bs-target="#forgotModal" data-bs-dismiss="modal">¿Olvidaste tu contraseña?</a>
            </div>
          </form>
          
          <div class="text-center mt-4">
            <p>¿No tienes cuenta? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Regístrate aquí</a></p>
          </div>
          
          <!-- Información adicional 
          <div class="mt-4 p-3 bg-light rounded">
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              <strong>Redirección automática:</strong><br>
              • Pacientes<br>
              • Odontólogos<br>
              • Administradores 
            </small>
          </div> -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Registro -->
  <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="registerModalLabel">
            <i class="fas fa-user-plus me-2"></i>Registro de Paciente
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <form id="registerForm">
            <!-- Información Personal -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="fas fa-user me-2"></i>Información Personal
              </h6>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="register-firstname" class="form-label">
                    <i class="fas fa-user me-1 text-muted"></i>Nombre *
                  </label>
                  <input type="text" class="form-control" id="register-firstname" 
                         placeholder="Ingresa tu nombre" required>
                  <div class="invalid-feedback">Por favor ingresa tu nombre</div>
                </div>
                <div class="col-md-6">
                  <label for="register-lastname" class="form-label">
                    <i class="fas fa-user me-1 text-muted"></i>Apellido *
                  </label>
                  <input type="text" class="form-control" id="register-lastname" 
                         placeholder="Ingresa tu apellido" required>
                  <div class="invalid-feedback">Por favor ingresa tu apellido</div>
                </div>
              </div>
            </div>

            <!-- Documentación -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="fas fa-id-card me-2"></i>Documentación
              </h6>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="register-tipo-documento" class="form-label">
                    <i class="fas fa-file-alt me-1 text-muted"></i>Tipo de documento *
                  </label>
                  <select class="form-select" id="register-tipo-documento" required>
                    <option value="">Selecciona el tipo...</option>
                    <option value="CC">Cédula de ciudadanía</option>
                    <option value="TI">Tarjeta de identidad</option>
                    <option value="CE">Cédula de extranjería</option>
                    <option value="PA">Pasaporte</option>
                  </select>
                  <div class="invalid-feedback">Selecciona un tipo de documento</div>
                </div>
                <div class="col-md-6">
                  <label for="register-numero-documento" class="form-label">
                    <i class="fas fa-hashtag me-1 text-muted"></i>Número de documento *
                  </label>
                  <input type="text" class="form-control" id="register-numero-documento" 
                         placeholder="Número de documento" required>
                  <div class="invalid-feedback">Ingresa un número de documento válido</div>
                </div>
              </div>
            </div>

            <!-- Contacto -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="fas fa-address-book me-2"></i>Información de Contacto
              </h6>
              <div class="row g-3">
                <div class="col-12">
                  <label for="register-email" class="form-label">
                    <i class="fas fa-envelope me-1 text-muted"></i>Correo electrónico *
                  </label>
                  <input type="email" class="form-control" id="register-email" 
                         placeholder="ejemplo@correo.com" required>
                  <div class="invalid-feedback">Ingresa un correo electrónico válido</div>
                </div>
                <div class="col-md-6">
                  <label for="register-phone" class="form-label">
                    <i class="fas fa-phone me-1 text-muted"></i>Teléfono *
                  </label>
                  <input type="tel" class="form-control" id="register-phone" 
                         placeholder="(+57) 300 123 4567" required>
                  <div class="invalid-feedback">Ingresa un número de teléfono válido</div>
                </div>
                <div class="col-md-6">
                  <label for="register-direccion" class="form-label">
                    <i class="fas fa-map-marker-alt me-1 text-muted"></i>Dirección *
                  </label>
                  <input type="text" class="form-control" id="register-direccion" 
                         placeholder="Calle, carrera y número" required>
                  <div class="invalid-feedback">Ingresa tu dirección</div>
                </div>
              </div>
            </div>

            <!-- Seguridad -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="fas fa-shield-alt me-2"></i>Configuración de Seguridad
              </h6>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="register-password" class="form-label">
                    <i class="fas fa-lock me-1 text-muted"></i>Contraseña *
                  </label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="register-password" 
                           placeholder="Crea una contraseña segura" required>
                    <button class="btn btn-outline-secondary" type="button" 
                            onclick="togglePasswordVisibility('register-password')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="invalid-feedback">La contraseña debe cumplir con los requisitos</div>
                  <!-- Validador de contraseña se insertará aquí -->
                  <div id="password-strength-container-register"></div>
                </div>
                <div class="col-md-6">
                  <label for="register-confirm" class="form-label">
                    <i class="fas fa-lock me-1 text-muted"></i>Confirmar contraseña *
                  </label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="register-confirm" 
                           placeholder="Repite tu contraseña" required>
                    <button class="btn btn-outline-secondary" type="button" 
                            onclick="togglePasswordVisibility('register-confirm')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="invalid-feedback">Las contraseñas no coinciden</div>
                </div>
              </div>
            </div>

            <!-- Información Adicional -->
            <div class="mb-4">
              <h6 class="text-primary mb-3">
                <i class="fas fa-calendar-alt me-2"></i>Información Adicional
              </h6>
              <div class="col-12">
                <label for="register-fecha-nacimiento" class="form-label">
                  <i class="fas fa-birthday-cake me-1 text-muted"></i>Fecha de nacimiento *
                </label>
                <input type="date" class="form-control" id="register-fecha-nacimiento" required>
                <div class="invalid-feedback">Selecciona tu fecha de nacimiento</div>
              </div>
            </div>

            <!-- Términos y Condiciones -->
            <div class="mb-4">
              <div class="card bg-light">
                <div class="card-body">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="register-terms" required>
                    <label class="form-check-label" for="register-terms">
                      <i class="fas fa-shield-check me-1 text-success"></i>
                      Acepto los <a href="#" class="text-decoration-none">términos y condiciones</a> 
                      y la <a href="#" class="text-decoration-none">política de privacidad</a> *
                    </label>
                    <div class="invalid-feedback">Debes aceptar los términos y condiciones</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="row g-3">
              <div class="col-12">
                <div id="register-error" class="alert alert-danger d-none"></div>
                <div id="register-success" class="alert alert-success d-none"></div>
              </div>
              <div class="col-12">
                <button type="submit" class="btn btn-primary btn-lg w-100" id="register-submit-btn">
                  <i class="fas fa-user-plus me-2"></i>Crear mi cuenta
                </button>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer bg-light">
          <div class="text-center w-100">
            <p class="mb-0">
              ¿Ya tienes cuenta? 
              <a href="#" class="text-decoration-none fw-bold" 
                 data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">
                Inicia sesión aquí
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Olvidé contraseña -->
  <div class="modal fade" id="forgotModal" tabindex="-1" aria-labelledby="forgotModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="forgotModalLabel">
            <i class="fas fa-shield-alt me-2"></i>Recuperar contraseña
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Paso 1: Solicitar Magic Link -->
          <div id="recovery-step-1" class="recovery-step active">
            <div class="text-center mb-4">
              <i class="fas fa-envelope text-primary mb-2" style="font-size: 2.5rem;"></i>
              <h5 class="mb-2">Recuperación por Email</h5>
              <p class="text-muted small">Recibirás un enlace seguro para restablecer tu contraseña</p>
            </div>
            
            <form id="security-form-step1">
              <div class="mb-3">
                <label for="security-email" class="form-label">Correo Electrónico</label>
                <input type="email" class="form-control" id="security-email" required>
              </div>
              <div class="mb-3">
                <label for="security-document" class="form-label">Número de Documento</label>
                <input type="text" class="form-control" id="security-document" required>
              </div>
              <button type="submit" class="btn btn-primary w-100" id="btn-send-link">
                <i class="fas fa-paper-plane me-2"></i>Enviar Enlace de Recuperación
              </button>
            </form>
            
            <div id="step1-alerts"></div>
          </div>
          
          <!-- Paso 2: Confirmación -->
          <div id="recovery-step-2" class="recovery-step d-none">
            <div class="text-center">
              <i class="fas fa-check-circle text-success mb-3" style="font-size: 3rem;"></i>
              <h5 class="text-success mb-3">¡Enlace Enviado!</h5>
              <p class="mb-3">Revisa tu correo electrónico y haz clic en el enlace para restablecer tu contraseña.</p>
              
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Importante:</strong> El enlace expira en 1 hora.
              </div>
              
              <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">
                <i class="fas fa-times me-2"></i>Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Preferencias de Notificaciones (después del registro) -->
  <div class="modal fade" id="preferencesModal" tabindex="-1" aria-labelledby="preferencesModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="preferencesModalLabel">
            <i class="fas fa-bell me-2"></i>Preferencias de Comunicación
          </h5>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <i class="fas fa-envelope-open-text text-primary mb-3" style="font-size: 3rem;"></i>
            <h5 class="mb-2">¡Bienvenido a Clinikdent!</h5>
            <p class="text-muted">Personaliza cómo deseas recibir información de nuestra parte</p>
          </div>

          <form id="preferences-form">
            <!-- Notificaciones Generales -->
            <div class="card mb-3">
              <div class="card-body">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="pref-notificaciones" checked>
                  <label class="form-check-label" for="pref-notificaciones">
                    <strong><i class="fas fa-bell me-2"></i>Notificaciones del Sistema</strong>
                    <p class="small text-muted mb-0">Recordatorios de citas, resultados de exámenes y avisos importantes</p>
                  </label>
                </div>
              </div>
            </div>

            <!-- Ofertas y Promociones -->
            <div class="card mb-3">
              <div class="card-body">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="pref-ofertas">
                  <label class="form-check-label" for="pref-ofertas">
                    <strong><i class="fas fa-gift me-2"></i>Ofertas y Promociones</strong>
                    <p class="small text-muted mb-0">Descuentos especiales, nuevos servicios y contenido exclusivo</p>
                  </label>
                </div>
              </div>
            </div>

            <!-- Canales de Comunicación -->
            <div class="card">
              <div class="card-body">
                <label class="form-label"><strong><i class="fas fa-paper-plane me-2"></i>Recibir por:</strong></label>
                <div class="form-check">
                  <input class="form-check-input canal-preferido" type="checkbox" id="canal-email" value="email" checked>
                  <label class="form-check-label" for="canal-email">
                    <i class="fas fa-envelope me-2"></i>Correo Electrónico
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input canal-preferido" type="checkbox" id="canal-dashboard" value="dashboard" checked>
                  <label class="form-check-label" for="canal-dashboard">
                    <i class="fas fa-desktop me-2"></i>Panel de Control
                  </label>
                </div>
              </div>
            </div>

            <div class="alert alert-info mt-3 small">
              <i class="fas fa-info-circle me-2"></i>
              Puedes cambiar estas preferencias en cualquier momento desde tu perfil.
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" id="btn-skip-preferences">
            <i class="fas fa-times me-2"></i>Omitir por ahora
          </button>
          <button type="button" class="btn btn-primary" id="btn-save-preferences">
            <i class="fas fa-check me-2"></i>Guardar Preferencias
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat de Soporte -->
  <!-- Botón flotante del chat -->
  <div id="chatFloatButton" class="chat-float-button" title="Chat de Soporte">
    <i class="fas fa-comments"></i>
  </div>

  <!-- Ventana del chat -->
  <div id="chatWindow" class="chat-window">
    <!-- Header del chat -->
    <div class="chat-header">
      <div class="chat-info">
        <div class="chat-avatar">
          <i class="fas fa-user-md"></i>
        </div>
        <div>
          <h4 class="chat-title">Clinik Dent</h4>
          <small class="chat-status">Asistente Virtual • En línea</small>
        </div>
      </div>
      <button class="chat-close" id="chatClose">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Área de mensajes -->
    <div id="chatMessages" class="chat-messages">
      <!-- Los mensajes se agregarán dinámicamente -->
    </div>

    <!-- Indicador de escritura -->
    <div id="typingIndicator" class="typing-indicator">
      <i class="fas fa-user-md"></i> El asistente está escribiendo<span class="typing-dots">...</span>
    </div>

    <!-- Opciones rápidas -->
    <div id="quickOptions" class="quick-options">
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('🏥 Servicios')">
        <i class="fas fa-tooth"></i> Servicios
      </button>
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('📅 Citas')">
        <i class="fas fa-calendar"></i> Citas
      </button>
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('⏰ Horarios')">
        <i class="fas fa-clock"></i> Horarios
      </button>
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('📍 Ubicación')">
        <i class="fas fa-map-marker-alt"></i> Ubicación
      </button>
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('💰 Precios')">
        <i class="fas fa-dollar-sign"></i> Precios
      </button>
      <button class="quick-option" onclick="window.chatSoporteInstance && window.chatSoporteInstance.sendMessage('🚨 Urgencia')">
        <i class="fas fa-exclamation-triangle"></i> Urgencia
      </button>
    </div>

    <!-- Área de input -->
    <div class="chat-input-area">
      <div class="input-container">
        <input type="text" id="chatInput" class="chat-input" placeholder="Escribe tu mensaje..." maxlength="500">
        <button id="chatSendBtn" class="chat-send-btn" title="Enviar mensaje">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- jQuery (debe ir antes de cualquier script que use $) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Tus scripts personalizados deben ir después de jQuery y Bootstrap -->
  <script src="js/scripts.js"></script>
  <!-- Configuración dinámica -->
  <script src="js/config-dinamica.js"></script>
  <!-- Chat de Soporte -->
  <script src="js/chat-soporte.js"></script>
  <!-- Breadcrumbs (posición fija bajo la navbar) -->
  <script src="js/breadcrumbs.js"></script>
  
  <!-- Utilidad de Toasts minimalistas -->
  <script>
    (function() {
      // Contenedor fijo arriba a la derecha
      let toastContainer = document.getElementById('toast-container');
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = 'position:fixed; top:20px; right:20px; z-index:9999; display:flex; flex-direction:column; gap:10px; max-width:380px;';
        document.body.appendChild(toastContainer);
      }

      function parseType(type) {
        switch(type) {
          case 'success': return {headerClass:'bg-success text-white', icon:'<i class="fas fa-check-circle me-2"></i>'};
          case 'warning': return {headerClass:'bg-warning text-dark', icon:'<i class="fas fa-exclamation-triangle me-2"></i>'};
          case 'danger':
          case 'error': return {headerClass:'bg-danger text-white', icon:'<i class="fas fa-times-circle me-2"></i>'};
          default: return {headerClass:'bg-primary text-white', icon:'<i class="fas fa-info-circle me-2"></i>'};
        }
      }

      function showToast(message, opts={}) {
        const { type='info', title=null, delay=4500 } = opts;
        const meta = parseType(type);
        const toastEl = document.createElement('div');
        toastEl.className = 'toast align-items-center show shadow-sm border-0';
        toastEl.setAttribute('role','status');
        toastEl.setAttribute('aria-live','polite');
        toastEl.setAttribute('aria-atomic','true');
        toastEl.style.cssText = 'min-width:260px;';
        toastEl.innerHTML = `
          <div class="toast-header ${meta.headerClass}">
            ${meta.icon}
            <strong class="me-auto">${title ? title : 'Notificación'}</strong>
            <button type="button" class="btn-close btn-close-white ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">${message}</div>
        `;

        toastContainer.appendChild(toastEl);
        const instance = new bootstrap.Toast(toastEl, { delay, autohide: true });
        toastEl.addEventListener('hidden.bs.toast', () => {
          if (toastEl.parentNode) toastEl.parentNode.removeChild(toastEl);
        });
        instance.show();
        return instance;
      }

      window.notify = {
        show: (msg, options) => showToast(msg, options),
        success: (msg, title='Éxito', delay=4000) => showToast(msg, { type:'success', title, delay }),
        info: (msg, title='Información', delay=4000) => showToast(msg, { type:'info', title, delay }),
        warning: (msg, title='Aviso', delay=4500) => showToast(msg, { type:'warning', title, delay }),
        error: (msg, title='Error', delay=5000) => showToast(msg, { type:'error', title, delay })
      };
    })();
  </script>
  
  <script>
    // Actualizar año de copyright
    document.getElementById('current-year').textContent = new Date().getFullYear();
    
    // Verificar parámetros de URL para mostrar mensajes de logout
    document.addEventListener('DOMContentLoaded', function() {
      checkLogoutMessages();
      
      // Asegurar que el carrusel de testimonios se inicialice correctamente
      const testimonialsCarousel = document.getElementById('testimonialsCarousel');
      if (testimonialsCarousel) {
        // Forzar visibilidad de la sección primero
        const testimonialsSection = document.getElementById('testimonios');
        if (testimonialsSection) {
          testimonialsSection.style.display = 'block';
          testimonialsSection.style.visibility = 'visible';
          testimonialsSection.style.opacity = '1';
        }
        
        // Asegurar que el carrusel sea visible
        testimonialsCarousel.style.display = 'block';
        testimonialsCarousel.style.visibility = 'visible';
        testimonialsCarousel.style.opacity = '1';
        
        // Asegurar que el primer elemento esté activo
        const firstCarouselItem = testimonialsCarousel.querySelector('.carousel-item');
        if (firstCarouselItem && !firstCarouselItem.classList.contains('active')) {
          firstCarouselItem.classList.add('active');
        }
        
        // Inicializar el carrusel manualmente con configuración específica
        try {
          const carouselInstance = new bootstrap.Carousel(testimonialsCarousel, {
            interval: 6000,
            ride: 'carousel',
            wrap: true,
            keyboard: true,
            pause: 'hover'
          });
          
          console.log('✅ Carrusel de testimonios inicializado correctamente');
          
          // Forzar que se muestre el primer slide
          setTimeout(() => {
            carouselInstance.to(0);
          }, 100);
          
        } catch (error) {
          console.error('❌ Error al inicializar carrusel:', error);
        }
      } else {
        console.error('❌ No se encontró el elemento #testimonialsCarousel');
      }
    });
    
    // Función para verificar mensajes de logout
    function checkLogoutMessages() {
      const urlParams = new URLSearchParams(window.location.search);
      const logoutStatus = urlParams.get('logout');
      const sessionStatus = urlParams.get('session');
      
      let message = '';
      let alertType = 'info';
      
      if (logoutStatus === 'success' || logoutStatus === 'true') {
        message = '✅ Sesión cerrada exitosamente. Gracias por usar nuestro sistema.';
        alertType = 'success';
      } else if (sessionStatus === 'expired') {
        message = '⚠️ Tu sesión ha expirado. Por favor, inicia sesión nuevamente.';
        alertType = 'warning';
      } else if (sessionStatus === 'timeout') {
        message = '⏰ Tu sesión expiró por inactividad. Por favor, inicia sesión nuevamente.';
        alertType = 'warning';
      }
      
      if (message) {
        showLogoutAlert(message, alertType);
        
        // Limpiar los parámetros de la URL sin recargar la página
        const url = new URL(window.location);
        url.searchParams.delete('logout');
        url.searchParams.delete('session');
        window.history.replaceState({}, document.title, url.pathname + url.search);
      }
    }
    
    // Función para mostrar alertas de logout (ahora como toast minimalista)
    function showLogoutAlert(message, type) {
      const map = { success:'success', warning:'warning', info:'info', danger:'error', error:'error' };
      const toastType = map[type] || 'info';
      notify.show(message, { type: toastType, title: 'Sesión', delay: 6000 });
    }
    
    // Validación de formularios
    (function () {
      'use strict'
      var forms = document.querySelectorAll('.needs-validation')
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }
            form.classList.add('was-validated')
          }, false)
        })
    })()
    
    // Login universal con detección automática de rol y redirección
    // Crear div de error si no existe
    if (!document.getElementById('login-error')) {
      const errDiv = document.createElement('div');
      errDiv.id = 'login-error';
      errDiv.className = 'alert alert-danger mt-3 d-none';
      document.getElementById('form-login-universal').appendChild(errDiv);
    }

    // El sistema de seguridad se encargará del login automáticamente
    // Ya no necesitamos este manejador manual
    console.log('✅ Sistema de login delegado al SecurityManager');
    
    // Registro real de paciente
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
  const errorDiv = document.getElementById('register-error');
  const successDiv = document.getElementById('register-success');
  errorDiv.classList.add('d-none');
  successDiv.classList.add('d-none');
      // Validación de contraseñas
      if (document.getElementById('register-password').value !== 
          document.getElementById('register-confirm').value) {
        notify.warning('Las contraseñas no coinciden');
        return;
      }
      // Validación de términos
      if (!document.getElementById('register-terms').checked) {
        notify.warning('Debes aceptar los términos y condiciones');
        return;
      }
      try {
        const formData = {
          nombre: document.getElementById('register-firstname').value,
          apellido: document.getElementById('register-lastname').value,
          tipo_documento: document.getElementById('register-tipo-documento').value,
          numero_documento: document.getElementById('register-numero-documento').value,
          correo: document.getElementById('register-email').value,
          password: document.getElementById('register-password').value,
          telefono: document.getElementById('register-phone').value,
          direccion: document.getElementById('register-direccion').value,
          fecha_nacimiento: document.getElementById('register-fecha-nacimiento').value,
          acepta_politica: true,
          rol: 'paciente'
        };
        console.log('Datos enviados al backend:', formData); // DEBUG
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.msg || 'Error en el registro');
        
        // Guardar usuario_id temporalmente para preferencias
        window.tempUserId = data.usuario_id || data.id;
        
        notify.success('¡Registro exitoso!');
        
        // Cerrar modal de registro y abrir modal de preferencias
        $('#registerModal').modal('hide');
        document.getElementById('registerForm').reset();
        errorDiv.classList.add('d-none');
        successDiv.classList.add('d-none');
        
        // Mostrar modal de preferencias después de medio segundo
        setTimeout(() => {
          $('#preferencesModal').modal('show');
        }, 500);
        
      } catch (error) {
        // Mostrar error en toast Y en el formulario
        notify.error(error.message || 'Error en el registro');
        
        // Mostrar error también en el modal
        errorDiv.textContent = error.message || 'Error en el registro';
        errorDiv.classList.remove('d-none');
        successDiv.classList.add('d-none');
        
        // Scroll al error en el modal
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
    

    
    // Formulario PQRS mejorado
    document.getElementById('pqrsForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
  const errorDiv = document.getElementById('pqrs-error');
  const successDiv = document.getElementById('pqrs-success');
  errorDiv.classList.add('d-none');
  successDiv.classList.add('d-none');
      
      // Validar campos requeridos
      const requiredFields = ['nombre_completo', 'correo', 'tipo', 'descripcion'];
      let hasErrors = false;
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
          field.classList.add('is-invalid');
          hasErrors = true;
        } else {
          field.classList.remove('is-invalid');
        }
      });
      
      if (hasErrors) {
        notify.warning('Por favor completa todos los campos requeridos.');
        return;
      }
      
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
      submitBtn.disabled = true;
      
      try {
        const formData = {
          nombre_completo: document.getElementById('nombre_completo').value,
          correo: document.getElementById('correo').value,
          telefono: document.getElementById('telefono').value || null,
          numero_documento: document.getElementById('numero_documento').value || null,
          tipo: document.getElementById('tipo').value,
          descripcion: document.getElementById('descripcion').value,
          servicio_relacionado: document.getElementById('servicio_relacionado').value || null
        };
        
        const response = await fetch('/api/pqrs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (!response.ok) throw new Error(data.msg || 'Error al enviar el PQRS');
        notify.success('¡Tu PQRS ha sido enviada correctamente!');
        this.reset();
        
      } catch (error) {
        notify.error(error.message || 'Error al enviar el PQRS');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    // ✅ Sistema de Recuperación Segura Integrado en Modal
    let recoveryTimer = null;
    
    // Paso 1: Solicitar código
    document.getElementById('security-form-step1').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('security-email').value;
      const document_number = document.getElementById('security-document').value;
      const submitBtn = document.getElementById('btn-send-link');
      const alertsDiv = document.getElementById('step1-alerts');
      
      // Limpiar alertas previas
      alertsDiv.innerHTML = '';
      
      // Estado de carga
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch('/api/seguridad/recuperar-password-supabase', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ correo: email, numero_documento: document_number })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // Ir al paso 2 (confirmación)
          showRecoveryStep(2);
        } else {
          showAlert('step1-alerts', data.bloqueado ? 'danger' : 'warning', data.msg);
        }
        
      } catch (error) {
        showAlert('step1-alerts', 'danger', 'Error de conexión. Intente nuevamente.');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });
    
    // Limpiar modal al cerrarlo
    document.getElementById('forgotModal').addEventListener('hidden.bs.modal', function() {
      showRecoveryStep(1);
      document.getElementById('security-form-step1').reset();
      document.getElementById('step1-alerts').innerHTML = '';
    });
    
    // Funciones auxiliares
    function showRecoveryStep(step) {
      // Ocultar todos los pasos
      document.querySelectorAll('.recovery-step').forEach(el => el.classList.add('d-none'));
      
      // Mostrar el paso actual
      document.getElementById('recovery-step-' + step).classList.remove('d-none');
    }
    
    function showAlert(containerId, type, message) {
      const container = document.getElementById(containerId);
      const alertClass = type === 'success' ? 'alert-success' : 
                        type === 'warning' ? 'alert-warning' : 'alert-danger';
      
      container.innerHTML = `
        <div class="alert ${alertClass} mt-3 small">
          ${message}
        </div>
      `;
    }

  </script>

  <!-- Script para Chat de Soporte -->
  <script>
    // Objeto global para el chat de soporte
    window.chatSoporte = {
      openChat: function() {
        // Abrir el chat en una nueva ventana
        const chatWindow = window.open(
          '/chat-soporte.html',
          'ChatSoporte',
          'width=900,height=700,scrollbars=no,resizable=yes,status=no,location=no,toolbar=no,menubar=no'
        );
        
        // Centrar la ventana
        if (chatWindow) {
          chatWindow.focus();
        }
      }
    };

    // También permitir abrir con función directa
    function abrirChatSoporte() {
      window.chatSoporte.openChat();
    }
  </script>
  
  <!-- Script dinámico para cargar FAQs desde API (deja el HTML estático como fallback) -->
  <script>
    (function cargarFAQsDinamicas() {
      const acc = document.getElementById('faqAccordion');
      if (!acc) return;
      
      fetch('/api/faqs')
        .then(r => r.json())
        .then(json => {
          if (!json || !json.success || !Array.isArray(json.faqs) || json.faqs.length === 0) {
            acc.innerHTML = '<div class="alert alert-info">No hay preguntas frecuentes disponibles por ahora.</div>';
            return;
          }
          const faqs = json.faqs.sort((a,b) => (a.orden??9999) - (b.orden??9999));
          console.log(`[FAQ] Renderizando ${faqs.length} FAQs desde BD`);
          acc.innerHTML = faqs.map((f, idx) => {
            const i = idx+1;
            const q = (f.pregunta||'').trim();
            const a = (f.respuesta||'').trim();
            // simple escape básico
            const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
            return `
              <div class="accordion-item border-0 shadow-sm mb-3">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq${i}" aria-expanded="false" aria-controls="faq${i}">
                    <i class="fas fa-question-circle me-3 text-primary"></i>
                    ${esc(q)}
                  </button>
                </h2>
                <div id="faq${i}" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">${a}</div>
                </div>
              </div>`;
          }).join('');
        })
        .catch((err) => {
          console.warn('[FAQ] Error cargando FAQs:', err);
          acc.innerHTML = '<div class="alert alert-warning">No se pudieron cargar las preguntas frecuentes.</div>';
        });
    })();
  </script>

  <!-- Contenido dinámico de landing -->
  <script src="/js/site-content.js"></script>

  <!-- Bootstrap Icons -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Sistema de Alertas y Seguridad Mejorado -->
  <script src="/js/alerts-override.js"></script>
  <script src="/js/alerts-init.js"></script>
  <script src="/js/security-system.js"></script>
  <script src="/js/password-validator.js"></script>
  
  <!-- Estilos de Validación de Contraseñas -->
  <link rel="stylesheet" href="/css/password-validator.css">
  
  <script>
    // Inicialización del sistema mejorado
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🔐 Inicializando sistema de seguridad y alertas...');
      
      // Verificar componentes principales
      const components = [
        { name: 'Alertas Modernas', check: () => window.showCustomAlert },
        { name: 'Sistema de Seguridad', check: () => window.securityManager },
        { name: 'Validador de Contraseñas', check: () => window.PasswordValidator }
      ];
      
      const loaded = components.filter(comp => comp.check()).map(comp => comp.name);
      const failed = components.filter(comp => !comp.check()).map(comp => comp.name);
      
      console.log(`✅ Componentes activos: ${loaded.join(', ')}`);
      if (failed.length > 0) {
        console.log(`⚠️ Componentes pendientes: ${failed.join(', ')}`);
      }
    });
    
    // Función para dashboard de seguridad
    window.openSecurityDashboard = function() {
      window.open('/security-dashboard.html', '_blank');
    };
    
    // Funciones para mejorar el formulario de registro
    window.togglePasswordVisibility = function(fieldId) {
      const field = document.getElementById(fieldId);
      const button = field.nextElementSibling.querySelector('i');
      
      if (field.type === 'password') {
        field.type = 'text';
        button.className = 'fas fa-eye-slash';
      } else {
        field.type = 'password';
        button.className = 'fas fa-eye';
      }
    };
    
    // Validación en tiempo real del formulario
    document.addEventListener('DOMContentLoaded', function() {
      const registerPassword = document.getElementById('register-password');
      const registerConfirm = document.getElementById('register-confirm');
      
      // Inicializar validador de contraseñas para registro
      if (registerPassword && window.PasswordValidator) {
        setTimeout(() => {
          new PasswordValidator('register-password', 'password-strength-container-register');
        }, 1000);
      }
      
      // Validar confirmación de contraseña
      if (registerConfirm) {
        registerConfirm.addEventListener('input', function() {
          const password = registerPassword.value;
          const confirm = this.value;
          
          if (confirm && password !== confirm) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
          } else if (confirm && password === confirm) {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
          } else {
            this.classList.remove('is-valid', 'is-invalid');
          }
        });
      }
      
      // Validación básica de campos
      const requiredFields = [
        'register-firstname',
        'register-lastname', 
        'register-email',
        'register-phone',
        'register-numero-documento'
      ];
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('blur', function() {
            if (this.value.trim()) {
              this.classList.add('is-valid');
              this.classList.remove('is-invalid');
            } else {
              this.classList.add('is-invalid');
              this.classList.remove('is-valid');
            }
          });
        }
      });
      
      // Validación de email
      const emailField = document.getElementById('register-email');
      if (emailField) {
        emailField.addEventListener('blur', function() {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (emailRegex.test(this.value)) {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
          } else {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
          }
        });
      }
      
      // Validación de teléfono
      const phoneField = document.getElementById('register-phone');
      if (phoneField) {
        phoneField.addEventListener('input', function() {
          // Formatear número de teléfono automáticamente
          let value = this.value.replace(/\D/g, '');
          if (value.length >= 10) {
            value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
          }
          this.value = value;
        });
      }
    });

    // ===================================================================
    // MANEJO DEL MODAL DE PREFERENCIAS DE NOTIFICACIONES
    // ===================================================================
    
    // Guardar preferencias
    document.getElementById('btn-save-preferences').addEventListener('click', async function() {
      const btnSave = this;
      const originalText = btnSave.innerHTML;
      
      try {
        btnSave.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Guardando...';
        btnSave.disabled = true;
        
        // Obtener valores del formulario
        const acepta_notificaciones = document.getElementById('pref-notificaciones').checked;
        const acepta_ofertas = document.getElementById('pref-ofertas').checked;
        
        // Obtener canales preferidos
        const canales = [];
        document.querySelectorAll('.canal-preferido:checked').forEach(canal => {
          canales.push(canal.value);
        });
        
        const preferencias = {
          usuario_id: window.tempUserId,
          acepta_notificaciones,
          acepta_ofertas,
          canales_preferidos: canales
        };
        
        const response = await fetch('/api/preferencias', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(preferencias)
        });
        
        const data = await response.json();
        
        if (data.success) {
          notify.success('✅ Preferencias guardadas correctamente');
          $('#preferencesModal').modal('hide');
          
          // Mostrar modal de login después de 500ms
          setTimeout(() => {
            $('#loginModal').modal('show');
          }, 500);
        } else {
          throw new Error(data.msg || 'Error al guardar preferencias');
        }
        
      } catch (error) {
        console.error('Error guardando preferencias:', error);
        notify.error('Error al guardar preferencias');
      } finally {
        btnSave.innerHTML = originalText;
        btnSave.disabled = false;
      }
    });
    
    // Omitir preferencias
    document.getElementById('btn-skip-preferences').addEventListener('click', async function() {
      try {
        // Guardar preferencias por defecto (todo desactivado)
        const preferencias = {
          usuario_id: window.tempUserId,
          acepta_notificaciones: false,
          acepta_ofertas: false,
          canales_preferidos: []
        };
        
        await fetch('/api/preferencias', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(preferencias)
        });
        
        $('#preferencesModal').modal('hide');
        
        // Mostrar modal de login
        setTimeout(() => {
          $('#loginModal').modal('show');
        }, 500);
        
      } catch (error) {
        console.error('Error:', error);
        $('#preferencesModal').modal('hide');
        setTimeout(() => {
          $('#loginModal').modal('show');
        }, 500);
      }
    });

  </script>
</body>
</html>