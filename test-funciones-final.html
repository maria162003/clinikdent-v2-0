<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Funciones Citas - Verificaci√≥n Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="alert alert-success">
            <h4>‚úÖ Problema Resuelto</h4>
            <p>Se elimin√≥ una funci√≥n duplicada <code>reprogramarCita</code> que estaba causando conflictos.</p>
            <p><strong>Los botones de acciones de citas ahora deber√≠an funcionar correctamente.</strong></p>
        </div>
        
        <h2>Test Final - Botones de Citas</h2>
        
        <!-- Modal para detalles de cita -->
        <div class="modal fade" id="detallesCitaModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Detalles de la Cita</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Fecha:</strong> <span id="detalleFecha">-</span></p>
                                <p><strong>Hora:</strong> <span id="detalleHora">-</span></p>
                                <p><strong>Doctor:</strong> <span id="detalleDoctor">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Motivo:</strong> <span id="detalleMotivo">-</span></p>
                                <p><strong>Estado:</strong> <span id="detalleEstadoBadge">-</span></p>
                            </div>
                        </div>
                        <div id="detalleEstadoDescripcion" class="mt-2"></div>
                        <div id="detalleNotasContainer" class="mt-3" style="display: none;">
                            <strong>Notas:</strong>
                            <p id="detalleNotas"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-warning" id="reprogramarCitaBtn">Reprogramar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para reprogramar cita -->
        <div class="modal fade" id="reprogramarModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Reprogramar Cita</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="reprogramarForm">
                            <input type="hidden" id="reprogramarCitaId">
                            <div class="mb-3">
                                <label class="form-label">Cita Actual:</label>
                                <p><span id="citaActualFecha">-</span> a las <span id="citaActualHora">-</span></p>
                                <p>Motivo: <span id="citaActualMotivo">-</span></p>
                            </div>
                            <hr>
                            <div class="mb-3">
                                <label for="nuevaFecha" class="form-label">Nueva Fecha *</label>
                                <input type="date" class="form-control" id="nuevaFecha" required>
                            </div>
                            <div class="mb-3">
                                <label for="nuevaHora" class="form-label">Nueva Hora *</label>
                                <input type="time" class="form-control" id="nuevaHora" required>
                            </div>
                            <div class="mb-3">
                                <label for="nuevoMotivo" class="form-label">Motivo (opcional)</label>
                                <input type="text" class="form-control" id="nuevoMotivo">
                            </div>
                            <div class="mb-3">
                                <label for="nuevasNotas" class="form-label">Notas adicionales</label>
                                <textarea class="form-control" id="nuevasNotas" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="confirmarReprogramarBtn">Confirmar Reprogramaci√≥n</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>üß™ Cita de Prueba (ID: 999)</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p><strong>Fecha:</strong> 2024-01-15</p>
                        <p><strong>Hora:</strong> 10:00</p>
                        <p><strong>Doctor:</strong> Dr. Carlos Rodriguez</p>
                        <p><strong>Motivo:</strong> Consulta general</p>
                        <p><strong>Estado:</strong> <span class="badge bg-success">Confirmada</span></p>
                    </div>
                    <div class="col-md-4">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="dashboardPaciente.verDetalleCita(999)" title="Ver detalles">
                                <i class="bi bi-eye"></i> Ver Detalles
                            </button>
                            <button class="btn btn-outline-warning" onclick="dashboardPaciente.reprogramarCita(999)" title="Reprogramar">
                                <i class="bi bi-calendar-event"></i> Reprogramar
                            </button>
                            <button class="btn btn-outline-danger" onclick="dashboardPaciente.cancelarCita(999)" title="Cancelar">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <div class="alert alert-info">
                <h5>üìã Instrucciones de Prueba:</h5>
                <ol>
                    <li><strong>Ver Detalles:</strong> Deber√≠a mostrar un modal con los detalles de la cita</li>
                    <li><strong>Reprogramar:</strong> Deber√≠a mostrar un modal para cambiar fecha/hora (con validaciones de 24h)</li>
                    <li><strong>Cancelar:</strong> Deber√≠a mostrar un di√°logo de confirmaci√≥n (con validaciones de tiempo)</li>
                </ol>
                <p><strong>Nota:</strong> Estas son funciones de prueba con datos mockeados. En el dashboard real usar√°n datos reales de la base de datos.</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Mock localStorage data
        localStorage.setItem('user', JSON.stringify({
            id: 1,
            nombre: 'Usuario',
            apellido: 'Test',
            correo: 'test@example.com'
        }));
        
        // Mock authFetch
        window.authFetch = function(url, options = {}) {
            console.log('Mock authFetch:', url, options);
            return Promise.resolve({
                ok: true,
                json: () => Promise.resolve({ success: true, msg: 'Operaci√≥n simulada exitosa' })
            });
        };
        
        // Mock cita data for testing
        const citaMock = {
            id: 999,
            fecha: '2024-01-15T00:00:00.000Z',
            hora: '10:00:00',
            motivo: 'Consulta general',
            estado: 'confirmada',
            odontologo_nombre: 'Carlos',
            odontologo_apellido: 'Rodriguez',
            notas: 'Cita de prueba para verificar funcionalidad'
        };
    </script>
    
    <!-- Load dashboard script -->
    <script src="js/dashboard-paciente.js"></script>
    
    <script>
        // Wait for dashboard to load and then inject mock data
        setTimeout(() => {
            if (window.dashboardPaciente) {
                console.log('‚úÖ Dashboard cargado correctamente');
                
                // Inject mock cita data
                window.dashboardPaciente.citas = [citaMock];
                
                console.log('‚úÖ Datos mock inyectados');
                console.log('üß™ Citas disponibles:', window.dashboardPaciente.citas.length);
                
                // Test functions availability
                const funciones = ['verDetalleCita', 'reprogramarCita', 'cancelarCita'];
                funciones.forEach(funcion => {
                    if (typeof window.dashboardPaciente[funcion] === 'function') {
                        console.log(`‚úÖ ${funcion} disponible`);
                    } else {
                        console.log(`‚ùå ${funcion} NO disponible`);
                    }
                });
                
            } else {
                console.log('‚ùå Dashboard NO cargado');
            }
        }, 1000);
    </script>
</body>
</html>