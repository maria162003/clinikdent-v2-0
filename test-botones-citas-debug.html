<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Botones Citas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Test de Botones de Citas</h2>
        
        <div class="alert alert-info">
            <p><strong>Instrucciones:</strong></p>
            <ol>
                <li>Abre la consola del navegador (F12)</li>
                <li>Haz clic en los botones de abajo</li>
                <li>Verifica que aparezcan mensajes en la consola</li>
            </ol>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>Cita de Prueba</h5>
            </div>
            <div class="card-body">
                <p><strong>Fecha:</strong> 2024-01-15</p>
                <p><strong>Hora:</strong> 10:00</p>
                <p><strong>Doctor:</strong> Dr. Carlos Rodriguez</p>
                <p><strong>Motivo:</strong> Consulta general</p>
                
                <div class="mt-3">
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="dashboardPaciente.verDetalleCita(123)" title="Ver detalles">
                        <i class="bi bi-eye"></i> Ver Detalles
                    </button>
                    <button class="btn btn-sm btn-outline-warning me-1" onclick="dashboardPaciente.reprogramarCita(123)" title="Reprogramar">
                        <i class="bi bi-calendar-event"></i> Reprogramar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="dashboardPaciente.cancelarCita(123)" title="Cancelar">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h5>Test Manual de Funciones</h5>
            <button class="btn btn-info" onclick="testFunciones()">Ejecutar Test de Funciones</button>
        </div>
        
        <div class="mt-4">
            <h5>Consola de Debug</h5>
            <div id="debugOutput" class="bg-light p-3" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mock localStorage for testing -->
    <script>
        // Mock user data for testing
        localStorage.setItem('user', JSON.stringify({
            id: 1,
            nombre: 'Usuario',
            apellido: 'Test',
            correo: 'test@example.com'
        }));
        
        // Mock de authFetch para testing
        window.authFetch = function(url, options = {}) {
            console.log('Mock authFetch called:', url, options);
            return Promise.resolve({
                ok: true,
                json: () => Promise.resolve([])
            });
        };
    </script>
    
    <!-- Include the dashboard script -->
    <script src="js/dashboard-paciente.js"></script>
    
    <!-- Include debug script -->
    <script src="test-botones-debug.js"></script>
    
    <script>
        // Redirect console.log to our debug output
        const debugDiv = document.getElementById('debugOutput');
        const originalLog = console.log;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            debugDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            debugDiv.scrollTop = debugDiv.scrollHeight;
        };
        
        function testFunciones() {
            console.log('=== INICIANDO TEST MANUAL ===');
            
            if (window.dashboardPaciente) {
                console.log('Probando verDetalleCita(999)...');
                try {
                    window.dashboardPaciente.verDetalleCita(999);
                    console.log('✅ verDetalleCita OK');
                } catch (e) {
                    console.log('❌ verDetalleCita ERROR:', e.message);
                }
                
                console.log('Probando reprogramarCita(999)...');
                try {
                    window.dashboardPaciente.reprogramarCita(999);
                    console.log('✅ reprogramarCita OK');
                } catch (e) {
                    console.log('❌ reprogramarCita ERROR:', e.message);
                }
                
                console.log('Probando cancelarCita(999)...');
                try {
                    window.dashboardPaciente.cancelarCita(999);
                    console.log('✅ cancelarCita OK');
                } catch (e) {
                    console.log('❌ cancelarCita ERROR:', e.message);
                }
            } else {
                console.log('❌ window.dashboardPaciente no está disponible');
            }
            
            console.log('=== TEST MANUAL COMPLETADO ===');
        }
        
        // Wait a bit for everything to load
        setTimeout(() => {
            console.log('🚀 Página completamente cargada. Dashboard disponible:', !!window.dashboardPaciente);
        }, 1000);
    </script>
</body>
</html>